# 部署后检查清单

本文档提供了部署投标管理系统后的检查清单，确保所有功能正常运行。

## 基础检查

- [x] 访问主页（http://localhost/）能否正常加载
- [x] 检查Nginx/Docker日志是否有错误
- [x] 确认服务启动正常（`docker-compose ps`显示所有服务为"Up"状态）

## Docker环境检查

- [x] Docker容器状态检查（bid-manage-container 和 bid-manage-nginx 是否正常运行）
- [x] Docker日志检查（确保没有重大错误或异常）
- [x] Docker网络检查（确保容器间网络通信正常）
- [x] Docker卷检查（确保数据持久化正常）
- [x] 资源使用情况检查（CPU、内存使用是否在合理范围内）

## 认证功能

- [x] 访问登录页面（http://localhost/login）能否正常加载
- [ ] 能否成功登录系统
- [ ] 登录后，刷新页面是否仍保持登录状态（解决之前的token持久化问题）
- [ ] 从仪表盘注销，并确认成功退出系统
- [ ] 尝试访问需要认证的页面时是否正确重定向到登录页面
- [ ] 登录后重定向到原始请求页面是否正常工作

## API功能

- [ ] 登录API端点（/api/login）是否正常工作
- [ ] 获取项目列表API是否返回正确数据
- [ ] 其他业务API是否能正确响应

## Cookie相关

- [ ] 使用浏览器开发者工具检查请求后的Cookie是否正确设置
- [ ] 验证token和user Cookie是否存在且过期时间正确
- [ ] 确认Cookie的secure标志设置是否与您的环境一致（HTTP使用false，HTTPS使用true）
- [ ] 在浏览器中手动删除Cookie，刷新页面后确认是否被正确重定向到登录页面

## 性能检查

- [ ] 首页加载时间是否在可接受范围内
- [ ] 登录过程是否流畅且没有明显延迟
- [ ] 页面导航和仪表盘操作是否顺畅

## 安全检查

- [ ] 确认API endpoint不能在未授权情况下访问
- [ ] 验证注销功能是否能完全清除所有认证Cookie
- [ ] 尝试通过URL参数进行简单的SQL注入测试，确保系统能够防御

## 跨域问题（如果适用）

- [ ] 如果从其他域访问API，确认CORS头部设置正确
- [ ] 确认预检（OPTIONS）请求能被正确处理

## 移动设备兼容性

- [ ] 在移动设备上访问系统，确保UI正确响应
- [ ] 测试移动设备上的登录功能
- [ ] 确保移动设备上的Cookie也能正确工作

## 错误处理

- [ ] 尝试输入错误的登录信息，确认系统给出友好的错误提示
- [ ] 故意访问不存在的页面，检查404页面是否正确显示
- [ ] 模拟服务器错误（例如通过修改API请求参数），确认系统给出合理的错误提示

## 注意事项

### 环境变量

确保以下环境变量正确设置：

- NODE_ENV=production
- 所有API密钥和访问令牌（如果适用）

### 备份

- [ ] 确认数据备份策略已经就位
- [ ] 记录部署的Docker映像版本以便回滚

### 监控

- [ ] 设置基本的服务监控（如有需要）
- [ ] 确保日志记录正确配置

## 问题排查快速参考

1. **Cookie问题**：
   - 检查login API中的Cookie设置代码
   - 确认secure标志与环境一致
   - 验证Nginx Cookie转发配置

2. **重定向循环**：
   - 检查中间件的重定向逻辑
   - 确认Cookie在重定向过程中是否被保留

3. **服务无法启动**：
   - 检查Docker日志：`docker-compose logs`
   - 验证端口是否已被占用：`lsof -i :80` 和 `lsof -i :443`

4. **API错误**：
   - 检查服务器日志中的错误信息
   - 验证API路由是否正确配置
